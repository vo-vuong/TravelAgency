@model Model.ViewModel.TourViewModel
@{
    ViewBag.Title = "Chi tiết Tour";
    Layout = "~/Views/Shared/Layout.cshtml";
    var listTourHot = (List<Model.EF.TOUR>)ViewBag.ListTourHot;
}

@section jsFooter{
    <script>
        $(document).ready(function () {
            $('.btn-number1').click(function (event) {
                event.preventDefault();
                var fieldName = $(this).attr('data-field1');
                var adults = $('#adultsMonney').text();
                var promotionAdults = $('#promotionAdults').text();
                var type = $(this).attr('data-type');
                var input = $("input[name='" + fieldName + "']");
                var currentInput = parseInt(input.val());
                var childrenInput = parseInt($('.totalChildren').html()); console.log(childrenInput);
                var babyInput = parseInt($('.totalBaby').html()); console.log(babyInput);
                //var sum = (currentInput+1)*parseInt(adults);console.log(sum);
                if (!isNaN(currentInput)) {
                    if (type == 'minus1') {
                        var minVal = parseInt(input.attr('min1'));
                        if (!minVal) minVal = 0;
                        if (currentInput > minVal) { input.val(currentInput - 1).change(); console.log(input.val()); subAdults = (currentInput - 1) * parseInt(adults) * (100 - parseInt(promotionAdults)) / 100;; $('.totalAdult').text(subAdults); totalMonney = parseInt($('.totalMonney').text(subAdults + childrenInput + babyInput)); }
                        if (parseInt(input.val()) == minVal) { $(this).attr('disabled', true); }
                    } else if (type == 'plus1') {
                        var maxVal = parseInt(input.attr('max1'));
                        if (!maxVal) maxVal = 10;
                        if (currentInput < maxVal) { input.val(currentInput + 1).change(); console.log(input.val()); sumAdults = (currentInput + 1) * parseInt(adults) * (100 - parseInt(promotionAdults)) / 100;; $('.totalAdult').html(sumAdults); totalMonney = parseInt($('.totalMonney').text(sumAdults + childrenInput + babyInput)); }
                        if (parseInt(input.val()) == maxVal) { $(this).attr('disabled', true); }
                    }
                } else { input.val(0); }
            });
            $('.input-number-adults').focusin(function () { $(this).data('rootVal', $(this).val()); });
            $('.input-number-adults').change(function () {
                var minValAdults = parseInt($(this).attr('minAdults'));
                var maxValAdults = parseInt($(this).attr('maxAdults'));
                if (!minValAdults) { minValAdults == 1 } if (!maxValAdults) { maxValAdults == 1 }
                var curVal = parseInt($(this).val());
                var nameVal = $(this).attr('name');
                if (curVal >= minValAdults) { $(".btn-number1[data-type='minus1']").removeAttr('disabled'); }
                else { alert('Không thể nhỏ hơn 0 !!!'); $(this).val($(this).data('rootVal')); }
                if (curVal <= maxValAdults) { $(".btn-number1[data-type='plus1']").removeAttr('disabled'); }
                else { alert('Tối đa chỉ được 10 !!!'); $(this).val($(this).data('rootVal')); }
            });
            $('.btn-number2').click(function (event) {
                event.preventDefault();
                var fieldName = $(this).attr('data-field2');
                var children = $('#childrenMonney').text();
                var promotionChildren = $('#promotionChildren').text();
                var type = $(this).attr('data-type');
                var input = $("input[name='" + fieldName + "']");
                var currentInput = parseInt(input.val());
                var adultsInput = parseInt($('.totalAdult').html()); console.log(adultsInput);
                var babyInput = parseInt($('.totalBaby').html()); console.log(babyInput);
                //var sum = (currentInput+1)*parseInt(adults);console.log(sum);
                if (!isNaN(currentInput)) {
                    if (type == 'minus2') {
                        var minVal = parseInt(input.attr('minChildren'));
                        if (!minVal) minVal = 0;
                        if (currentInput > minVal) { input.val(currentInput - 1).change(); console.log(input.val()); subChildren = (currentInput - 1) * parseInt(children) * (100 - parseInt(promotionChildren)) / 100; $('.totalChildren').html(subChildren); totalMonney = parseInt($('.totalMonney').text(subChildren + adultsInput + babyInput)); }
                        if (parseInt(input.val()) == minVal) { $(this).attr('disabled', true); }
                    } else if (type == 'plus2') {
                        var maxVal = parseInt(input.attr('maxChildren'));
                        if (!maxVal) maxVal = 10;
                        if (currentInput < maxVal) { input.val(currentInput + 1).change(); console.log(input.val()); sumChildren = (currentInput + 1) * parseInt(children) * (100 - parseInt(promotionChildren)) / 100; $('.totalChildren').html(sumChildren); totalMonney = parseInt($('.totalMonney').text(sumChildren + adultsInput + babyInput)); }
                        if (parseInt(input.val()) == maxVal) { $(this).attr('disabled', true); }
                    }
                } else { input.val(0); }
            });
            $('.input-number-children').focusin(function () { $(this).data('rootVal', $(this).val()); });
            $('.input-number-children').change(function () {
                var minValChildren = parseInt($(this).attr('minChildren'));
                var maxValChildren = parseInt($(this).attr('maxChildren'));
                if (!minValChildren) { minValChildren == 1 } if (!maxValChildren) { maxValChildren == 1 }
                var curVal = parseInt($(this).val());
                var nameVal = $(this).attr('name');
                if (curVal >= minValChildren) { $(".btn-number2[data-type='minus2']").removeAttr('disabled'); }
                else { alert('Không thể nhỏ hơn 0 !!!'); $(this).val($(this).data('rootVal')); }
                if (curVal <= maxValChildren) { $(".btn-number2[data-type='plus2']").removeAttr('disabled'); }
                else { alert('Tối đa chỉ được 10 !!!'); $(this).val($(this).data('rootVal')); }
            });
            $('.btn-number3').click(function (event) {
                event.preventDefault();
                var fieldName = $(this).attr('data-field3');
                var baby = $('#babyMonney').text();
                var promotionBaby = $('#promotionBaby').text();
                var type = $(this).attr('data-type');
                var input = $("input[name='" + fieldName + "']");
                var currentInput = parseInt(input.val());
                var adultsInput = parseInt($('.totalAdult').html());
                var childrenInput = parseInt($('.totalChildren').html());
                //var sum = (currentInput+1)*parseInt(adults);console.log(sum);
                if (!isNaN(currentInput)) {
                    if (type == 'minus3') {
                        var minVal = parseInt(input.attr('minBaby'));
                        if (!minVal) minVal = 0;
                        if (currentInput > minVal) { input.val(currentInput - 1).change(); console.log(input.val()); subBaby = (currentInput - 1) * parseInt(baby) * (100 - parseInt(promotionBaby)) / 100; $('.totalBaby').html(subBaby); totalMonney = parseInt($('.totalMonney').text(childrenInput + adultsInput + subBaby)); }
                        if (parseInt(input.val()) == minVal) { $(this).attr('disabled', true); }
                    } else if (type == 'plus3') {
                        var maxVal = parseInt(input.attr('maxBaby'));
                        if (!maxVal) maxVal = 10;
                        if (currentInput < maxVal) { input.val(currentInput + 1).change(); console.log(input.val()); sumBaby = (currentInput + 1) * parseInt(baby) * (100 - parseInt(promotionBaby)) / 100; $('.totalBaby').html(sumBaby); totalMonney = parseInt($('.totalMonney').text(sumBaby + adultsInput + childrenInput)); }
                        if (parseInt(input.val()) == maxVal) { $(this).attr('disabled', true); }
                    }
                } else { input.val(0); }
            });
            $('.input-number-baby').focusin(function () { $(this).data('rootVal', $(this).val()); });
            $('.input-number-baby').change(function () {
                var minValBaby = parseInt($(this).attr('minBaby'));
                var maxValBaby = parseInt($(this).attr('maxBaby'));
                if (!minValBaby) { minValBaby == 1 } if (!maxValBaby) { maxValBaby == 1 }
                var curVal = parseInt($(this).val());
                var nameVal = $(this).attr('name');
                if (curVal >= minValBaby) { $(".btn-number3[data-type='minus3']").removeAttr('disabled'); }
                else { alert('Không thể nhỏ hơn 0 !!!'); $(this).val($(this).data('rootVal')); }
                if (curVal <= maxValBaby) { $(".btn-number3[data-type='plus3']").removeAttr('disabled'); }
                else { alert('Tối đa chỉ được 10 !!!'); $(this).val($(this).data('rootVal')); }
            });
        });
        $(function () {
            $("#datepicker").datepicker({
                autoclose: true,
                todayHighlight: true
            }).datepicker('update', new Date());
        });
        $(".adultsValue").keydown(function (e) {
            var key = e.charCode || e.keyCode || 0;
            // allow backspace, tab, delete, enter, arrows, numbers and keypad numbers ONLY
            // home, end, period, and numpad decimal
            return (
                key == 8 ||
                key == 9 ||
                key == 13 ||
                key == 46 ||
                key == 110 ||
                key == 190 ||
                (key >= 35 && key <= 40) ||
                (key >= 48 && key <= 57) ||
                (key >= 96 && key <= 105));
        });
    </script>
}

<div class="container">
    <div class="row">
        <div class="col-xs-12" style="margin-top: 20px;margin-bottom: 10px;padding: 15px 20px 25px 20px;background-color: antiquewhite;">
            <div class="row">
                <div class="col-xs-12">
                    <h4 style="color: #0071BC;font-weight: bold;">@Model.TourName</h4>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-6">
                    <img src="@Model.Image" class="img-thumbnail">
                    <table class="col-xs-12">
                        <th style="color: #CC0000;font-weight: bold;padding: 10px 20px;text-align: center;">Loại vé</th>
                        <th style="color: #CC0000;font-weight: bold;padding: 10px 20px;text-align: center;">Giá vé</th>
                        <th style="color: #CC0000;font-weight: bold;padding: 10px 20px;text-align: center;">Khuyến mãi (%)</th>
                        <tr>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;">Người lớn</td>
                            @if (Model.PriceSale != null)
                            {
                                <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" name="adults" id="adultsMonney">@(Model.PriceSale.HasValue ? Model.PriceSale.Value.ToString("N0") + "VND" : "Liên hệ")</td>
                            }
                            else
                            {
                                <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" name="adults" id="adultsMonney">@(Model.Price.HasValue ? Model.Price.Value.ToString("N0") + "VND" : "Liên hệ")</td>
                            }
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" id="promotionAdults">12</td>
                        </tr>
                        <tr>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;">Người cao tuổi</td>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" class="children" id="childrenMonney">@Model.Price</td>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" id="promotionChildren">15</td>
                        </tr>
                        <tr>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;">Trẻ em</td>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" class="baby" id="babyMonney">1990000</td>
                            <td style="color: #0071BC;font-weight: bold;padding: 10px 20px;text-align: center;" id="promotionBaby">17</td>
                        </tr>
                    </table>
                </div>
                <div class="col-xs-12 col-sm-6">
                    @*<div class="glyphicon glyphicon-menu-right" style="margin-bottom: 10px;"></div>&nbsp;<span>Di chuyển bằng : </span><span>Di chuyển bằng ô tô</span><br>
                        <div class="glyphicon glyphicon-menu-right" style="margin-bottom: 10px;"></div>&nbsp;<span>Ngày khởi hành : </span><span>Thứ 2 hằng tuần</span>*@
                    <div class="row">
                        <div class="col-xs-12">
                            <p style="line-height: 20px;"><div class="glyphicon glyphicon-leaf"></div>&nbsp;@Model.Shortbody</p>
                        </div>
                    </div>
                    <label class="col-xs-6">Còn 1 tour</label>
                </div>
                <div class="row">
                    <form method="" action="" class="col-xs-12 col-sm-6">
                        <table>
                            <tr>
                                <th class="col-xs-4 col-sm-2 col-md-3" style="text-align: center;color: #CC0000;">Loại khách</th>
                                <th class="col-xs-5 col-sm-4 col-md-3" style="text-align: center;color: #CC0000;">Số lượng</th>
                                <th class="col-xs-3 col-sm-3 col-md-3" style="text-align: center;color: #CC0000;">Tổng giá</th>
                            </tr>
                            <tr>
                                <td class="col-xs-2" style="color: #0071BC;font-weight: bold;text-align: center;">Người lớn</td>
                                <td style="padding: 5px;">
                                    <div class="input-group col-xs-12 col-sm-12 col-md-11" style="margin: 0 auto">
                                        <span class="input-group-btn ">
                                            <button type="button" class="btn btn-default btn-number1" data-type="minus1" data-field1="quantity1">
                                                <span class="glyphicon glyphicon-minus"></span>
                                            </button>
                                        </span>
                                        <input type="text" name="quantity1" value="0" minAdults="0" maxAdults="10" class="form-control input-number-adults adultsValue" style="text-align: center;" readonly>
                                        <span class="input-group-btn ">
                                            <button type="button" class="btn btn-default btn-number1" data-type="plus1" data-field1="quantity1">
                                                <span class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </span>
                                    </div>
                                </td>
                                <td class="col-xs-2" style="color: #0071BC;font-weight: bold;text-align: center;"><span class="totalAdult">0</span></td>
                            </tr>
                            <tr>
                                <td class="col-xs-2" style="color: #0071BC;font-weight: bold;text-align: center;">Em bé</td>
                                <td style="padding: 5px;">
                                    <div class="input-group col-xs-12 col-sm-12 col-md-11" style="margin: 0 auto">
                                        <span class="input-group-btn ">
                                            <button type="button" class="btn btn-default btn-number2" data-type="minus2" data-field2="quantity2">
                                                <span class="glyphicon glyphicon-minus"></span>
                                            </button>
                                        </span>
                                        <input type="text" name="quantity2" value="0" minChildren="0" maxChildren="10" class="form-control input-number-children childrenValue" style="text-align: center;" readonly>
                                        <span class="input-group-btn ">
                                            <button type="button" class="btn btn-default btn-number2" data-type="plus2" data-field2="quantity2">
                                                <span class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </span>
                                    </div>
                                </td>
                                <td class="col-xs-2" style="color: #0071BC;font-weight: bold;text-align: center;"><span class="totalChildren">0</span></td>
                            </tr>
                            <tr>
                                <td class="col-xs-2" style="color: #0071BC;font-weight: bold;text-align: center;">Trẻ em</td>
                                <td style="padding: 5px;">
                                    <div class="input-group col-xs-12 col-sm-12 col-md-11" style="margin: 0 auto">
                                        <span class="input-group-btn ">
                                            <button type="button" class="btn btn-default btn-number3" data-type="minus3" data-field3="quantity3">
                                                <span class="glyphicon glyphicon-minus"></span>
                                            </button>
                                        </span>
                                        <input type="text" name="quantity3" value="0" minBaby="0" maxBaby="10" class="form-control input-number-baby babyValue" style="text-align: center;" readonly>
                                        <span class="input-group-btn ">
                                            <button type="button" class="btn btn-default btn-number3" data-type="plus3" data-field3="quantity3">
                                                <span class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </span>
                                    </div>
                                </td>
                                <td class="col-xs-2" style="color: #0071BC;font-weight: bold;text-align: center;"><span class="totalBaby">0</span></td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;text-align: center;color: #CC0000;padding-top: 5px;padding-bottom: 5px;">Tổng tiền</td>
                                <td style="color: #CC0000;font-weight: bold;text-align: center;"><span class="totalMonney">0</span><span>&nbsp;VNĐ</span></td>
                                <td></td>
                            </tr>
                        </table>
                        <div class="col-xs-12">

                            <div class="col-xs-6">
                                <div id="datepicker" class="input-group date" data-date-format="dd-mm-yyyy">
                                    <input class="form-control" readonly="" type="text" name="calendar"> <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                </div>
                            </div>
                            <div class="col-xs-6">
                                <button class="btn" style="padding-left: 30px;padding-right: 40px;background-color: #0071BC;color: #FFFFFF;"><span class="glyphicon glyphicon-send" style="margin-right: 20px;"></span>Đặt tour</buton>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-9">
            <h4 style="color: #0071BC;font-weight: bold;">LỊCH TRÌNH TOUR</h4>
            <div style="border: 1px dotted #000000;padding: 20px;">
                <div>
                    @Html.Raw(Model.Description)
                    <h4 style="color: #0071BC;font-weight: bold;">CHÍNH SÁCH TOUR</h4>
                    @Html.Raw(Model.policy)
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-3">
            <div>
                <h4 style="color: #0071BC;font-weight: bold;">Tour ngoài nước</h4>
                @foreach (var item in listTourHot)
                {
                    <div class="row" id="image" style="transition-duration: .4s;padding-bottom: 10px;">
                        <a href="/chi-tiet-tour/@item.IDTour"><img src="@item.Image" class="img-thumbnail"></a>
                        <a href="/chi-tiet-tour/@item.IDTour" style="text-decoration: none;"><h5 style="color: #FF0000;font-weight: bold;">@item.TourName</h5></a>
                        <span style="color: #0071BC;font-weight: bold;">@(Model.Price.HasValue ? Model.Price.Value.ToString("N0") + "VND" : "Liên hệ")</span>
                    </div>
                }
            </div>
        </div>
    </div>
</div>